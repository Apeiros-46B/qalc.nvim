local buffer_def_files = {}

au BufEnter *.qalc {
  local buf = bufnr()
  if !buffer_def_files[buf] {
    buffer_def_files[buf] = os.tmpname()
  }
  C++ {
    CALCULATOR->loadDefinitions(buffer_def_files[buf], true, false);
  }
}
au BufLeave *.qalc {
  local file = buffer_def_files[bufnr()]
  io.open(file, 'w'):close() // clears the file
  C++ {
    CALCULATOR->saveVariables(file, false);
    CALCULATOR->saveUnits(file, false);
    CALCULATOR->saveFunctions(file, false);
    CALCULATOR->reset();
  }
}
au BufWipeout *.qalc {
  os.remove(buffer_def_files[bufnr()])
}


